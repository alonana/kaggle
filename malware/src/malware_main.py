import pathlib
from datetime import datetime

import pandas as pd

DATA_FOLDER = "../data"
TRAIN_DATA = "%s/train.csv" % DATA_FOLDER

OUTPUT_FOLDER = "../output/"


def debug(msg, new_line=False):
    separator = ''
    if new_line:
        separator = '\n'
    print("{} ===> {}{}".format(datetime.now(), separator, msg))


class Malware:
    def __init__(self, csv_path, train_mode, calculation_limit_rows=None):
        pathlib.Path(OUTPUT_FOLDER).mkdir(parents=True, exist_ok=True)
        self.train_mode = train_mode
        self.calculation_limit_rows = calculation_limit_rows
        if calculation_limit_rows:
            self.head_lines = calculation_limit_rows
        else:
            self.head_lines = 5

        self.csv_path = csv_path

        for df in self.read_chunked_csv():
            debug("original data for path {} is:\n{}".format(csv_path, df.head(self.head_lines)))
            debug("{} rows loaded".format(df.shape[0]))
            break

    def read_chunked_csv(self):
        return pd.read_csv(self.csv_path, nrows=self.calculation_limit_rows, chunksize=5)

    def info(self):
        df = self.read_chunked_csv()
        debug(sum(c.apply(pd.value_counts).fillna(0) for c in df))


pd.set_option('display.max_rows', 5000)
pd.set_option('display.max_columns', 5000)
pd.set_option('display.width', 100000)

debug('Starting')
train = Malware(TRAIN_DATA, True, calculation_limit_rows=10)
train.info()
